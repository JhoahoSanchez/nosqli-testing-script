import requests
import json

# Leer URLs y payloads desde archivos
def read_urls(file_path):
    with open(file_path, 'r') as file:
        return [line.strip() for line in file.readlines()]

def read_payloads(file_path):
    with open(file_path, 'r') as file:
        return json.load(file)

# Probar NoSQL Injection
def test_nosql_injection(urls, payloads):
    results = []
    headers = {'Content-Type': 'application/json'}
    
    for url in urls:
        for payload in payloads:
            try:
                response = requests.post(url, json=payload, headers=headers, timeout=10)
                if response.status_code == 200 and "Login Successful" in response.text:
                    print(f"Vulnerable payload found: {payload} at {url}")
                    results.append({"url": url, "payload": payload, "status": "Vulnerable"})
                else:
                    print(f"Payload failed: {payload} at {url}")
                    results.append({"url": url, "payload": payload, "status": "Not Vulnerable"})
            except requests.exceptions.RequestException as e:
                print(f"Error testing payload {payload} at {url}: {e}")
                results.append({"url": url, "payload": payload, "status": "Error", "error": str(e)})
    
    return results

# Guardar resultados en un archivo
def save_results(results, file_path):
    with open(file_path, 'w') as file:
        json.dump(results, file, indent=4)

if __name__ == "__main__":
    urls = read_urls('urls.txt')
    payloads = read_payloads('payloads.json')
    results = test_nosql_injection(urls, payloads)
    save_results(results, 'results.json')
